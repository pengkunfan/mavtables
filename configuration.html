<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mavtables: Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mavtables
   &#160;<span id="projectnumber">0.2.1</span>
   </div>
   <div id="projectbrief">MAVLink router and firewall.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#mavlink-addressing">MAVLink Addressing</a><ul>
<li><a href="#mavlink-subnets">MAVLink Subnets</a></li>
</ul>
</li>
<li><a href="#basic-grammar">Basic Grammar</a><ul>
<li><a href="#identifiers">Identifiers</a></li>
<li><a href="#statements">Statements</a></li>
<li><a href="#blocks">Blocks</a></li>
<li><a href="#comments">Comments</a></li>
</ul>
</li>
<li><a href="#global-settings">Global Settings</a></li>
<li><a href="#udp-block">udp block</a><ul>
<li><a href="#port-statement">port statement</a></li>
<li><a href="#address-statement">address statement</a></li>
<li><a href="#max_bitrate-statement">max_bitrate statement</a></li>
</ul>
</li>
<li><a href="#serial-block">serial block</a><ul>
<li><a href="#device-statement">device statement</a></li>
<li><a href="#baudrate-statement">baudrate statement</a></li>
<li><a href="#flow_control-statement">flow_control statement</a></li>
<li><a href="#preload-statement">preload statement</a></li>
</ul>
</li>
<li><a href="#chain-block">chain block</a><ul>
<li><a href="#rules">Rules</a></li>
<li><a href="#action">Action</a></li>
<li><a href="#priority">Priority</a></li>
<li><a href="#condition">Condition</a><ul>
<li><a href="#packet-type">&lt;packet type&gt;</a></li>
<li><a href="#source-address">&lt;source address&gt;</a></li>
<li><a href="#dest-address">&lt;dest address&gt;</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>mavtables' configuration files are used to define default actions, interfaces, and filter chains. A full example configuration file can be found at <a href="../examples/mavtables.conf"><code>../examples/mavtables.conf</code></a>.</p>
<h1>MAVLink Addressing</h1>
<p>A MAVLink address consists of 2 octets. The first being the system ID and the second the component ID. Therefore, a MAVLink address looks like half of an IPv4 address. </p><div class="fragment"><div class="line">&lt;system ID&gt;.&lt;component ID&gt;</div></div><!-- fragment --><h2>MAVLink Subnets</h2>
<p>MAVLink subnets are similar to IP subnets and thus it is recommended that the reader understand IP subnets before continuing.</p>
<p>There are four representations of MAVLink subnets:</p>
<ol type="1">
<li>"\&lt;System ID&gt;.&lt;Component ID\&gt;:\&lt;System ID mask\&gt;.\&lt;Component ID mask\&gt;"</li>
<li>"\&lt;System ID&gt;.&lt;Component ID\&gt;/\&lt;bits\&gt;"</li>
<li>"\&lt;System ID&gt;.&lt;Component ID\&gt;\\&lt;bits\&gt;"</li>
<li>"\&lt;System ID&gt;.&lt;Component ID\&gt;"</li>
</ol>
<p>The first form is self explanatory, but the 2nd and 3rd are not as simple. In the 2nd case the number of bits (0 - 16) is the number of bits from the left that must match for an address to be in the subnet. The 3rd form is like the 2nd, but does not require the system ID (first octet) to match and starts with the number of bits of the component ID (0 - 8) that must match from the left for an address to be in the subnet. The last form is shorthand for "&lt;System ID&gt;.&lt;Component ID&gt;/16", that is an exact match.</p>
<p>Below is a table relating the slash postfix to the subnet mask in &lt;System mask&gt;.&lt;Component mask&gt; notation.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight">Mask with <code>/</code>  </th><th class="markdownTableHeadRight">Mask with <code>\</code>  </th><th class="markdownTableHeadRight">Postfix (#bits)   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">255.255  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">16   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">255.254  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">15   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">255.252  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">14   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">255.248  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">13   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">255.240  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">12   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">255.224  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">11   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">255.192  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">10   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">255.128  </td><td class="markdownTableBodyRight">out of range  </td><td class="markdownTableBodyRight">9   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">255.0  </td><td class="markdownTableBodyRight">0.255  </td><td class="markdownTableBodyRight">8   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">254.0  </td><td class="markdownTableBodyRight">0.254  </td><td class="markdownTableBodyRight">7   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">252.0  </td><td class="markdownTableBodyRight">0.252  </td><td class="markdownTableBodyRight">6   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">248.0  </td><td class="markdownTableBodyRight">0.248  </td><td class="markdownTableBodyRight">5   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">240.0  </td><td class="markdownTableBodyRight">0.240  </td><td class="markdownTableBodyRight">4   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">224.0  </td><td class="markdownTableBodyRight">0.224  </td><td class="markdownTableBodyRight">3   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">192.0  </td><td class="markdownTableBodyRight">0.192  </td><td class="markdownTableBodyRight">2   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight">128.0  </td><td class="markdownTableBodyRight">0.128  </td><td class="markdownTableBodyRight">1   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight">0.0  </td><td class="markdownTableBodyRight">0  </td><td class="markdownTableBodyRight">0   </td></tr>
</table>
<h1>Basic Grammar</h1>
<p>There are four major types of grammar elements in configuration files. These are identifiers, statements, blocks, and comments. Configuration files have a similar syntax to the C programming language and like C they are not whitespace sensitive.</p>
<h2>Identifiers</h2>
<p>An identifier is a name containing any combination of letters (upper and lower), digits, and the underscores ('_'). However, it must not start with a number. This is the same definition as identifiers in the C programming language.</p>
<h2>Statements</h2>
<p>A statement is defined as an identifier, followed by a value, and then the <em>end of statement</em> character '<code>;</code>'. Therefore, it takes the form of </p><div class="fragment"><div class="line">&lt;identifier&gt; &lt;value&gt;;</div></div><!-- fragment --><p> An example would be: </p><div class="fragment"><div class="line">boadrate 57600;</div></div><!-- fragment --><p> where '<code>boadrate</code>' is the identifier, '<code>57600</code>' is the value (in this case a number) and it ends with <code>;</code>.</p>
<h2>Blocks</h2>
<p>A block is a sectioning construct that can contain one or more statements, or in the special case of filter blocks, a rule. Blocks consist of a type and optionally an identifier followed by '<code>{</code>', one or more statements (or rules) and finally ending in '<code>}</code>'. The format is: </p><div class="fragment"><div class="line">&lt;type&gt; &lt;optional identifer&gt; {</div><div class="line">    &lt;statement 1&gt;;</div><div class="line">    &lt;statement 2&gt;;</div><div class="line">    &lt;statement ...&gt;;</div><div class="line">    &lt;statement n&gt;;</div><div class="line">}</div></div><!-- fragment --><p> An example would be: </p><div class="fragment"><div class="line">udp {</div><div class="line">    port 14555;</div><div class="line">    address 127.0.0.1;</div><div class="line">}</div></div><!-- fragment --><h2>Comments</h2>
<p>The comment character is '<code>#</code>'. Everything after this character to the end of the line is considered a comment and will be ignored. An example of using comments is: </p><div class="fragment"><div class="line">udp {  # UDP Inteface</div><div class="line">    port 14555;         # port number, the default is 14500</div><div class="line">    address 127.0.0.1;  # listen on localhost only, the default is any address</div><div class="line">}</div></div><!-- fragment --><h1>Global Settings</h1>
<p>The following sections document the components of a configuration file.</p>
<h2>default_action statement</h2>
<p>Set the default action to take when the filter does not determine what to do with a packet. The options are:</p><ul>
<li><code>accept</code> - to accept packets by default</li>
<li><code>reject</code> - to reject packets by default</li>
</ul>
<p>To accept packets by default use: </p><div class="fragment"><div class="line">default_action accept;</div></div><!-- fragment --><p> To reject packets by default use: </p><div class="fragment"><div class="line">default_action reject;</div></div><!-- fragment --><h1>udp block</h1>
<p>The <code>udp</code> block defines a UDP interface to listen for connections on. An example is: </p><div class="fragment"><div class="line">udp {</div><div class="line">    port 14555;</div><div class="line">    address 127.0.0.1;</div><div class="line">    max_bitrate 8388608;</div><div class="line">}</div></div><!-- fragment --><p>There is no limit to the number of UDP interfaces that can be defined.</p>
<h2>port statement</h2>
<p>A statement that sets the port number to listen on. The format is: </p><div class="fragment"><div class="line">port &lt;port number&gt;;</div></div><!-- fragment --><p>An example is: </p><div class="fragment"><div class="line">port 14555;</div></div><!-- fragment --><p>This is the only required statement in a <code>udp</code> block.</p>
<h2>address statement (optional)</h2>
<p>A statement that sets the IP address to listen on. The format is: </p><div class="fragment"><div class="line">address &lt;IP v4 address&gt;;</div></div><!-- fragment --><p>An example is: </p><div class="fragment"><div class="line">address 127.0.0.1;</div></div><!-- fragment --><p> which restricts mavtables to only listening for connections from <code>localhost</code>.</p>
<p><a class="el" href="classIf.html">If</a> not provided the default is to listen on every address and therefore to accept connections from remote systems (subject to the firewall's running on the host operating system).</p>
<h2>max_bitrate statement (optional)</h2>
<p>A statement that sets the bitrate limit (in bits per second) when transmitting packets over UDP. The format is: </p><div class="fragment"><div class="line">max_bitrate &lt;maximum bitrate&gt;</div></div><!-- fragment --><p>An example is: </p><div class="fragment"><div class="line">max_bitrate 8388608;  # 8 Mbps</div></div><!-- fragment --><p><a class="el" href="classIf.html">If</a> not provided there will not be any limit on the rate of packet transmission over UDP.</p>
<p><a class="el" href="classIf.html">If</a> downstream components tend to lose packets due to the operating system's UDP buffers filling up, consider slowing down mavtables by providing a bitrate limit. This feature was added because mavtables is much faster than components written in interpreted languages such as Python and thus must be limited so it can store packets in it's own buffers to avoid overflowing the operating system buffers.</p>
<h1>serial block</h1>
<p>The <code>serial</code> block defines a serial port interface to listen for connections on. An example is: </p><div class="fragment"><div class="line">serial {</div><div class="line">    device /dev/ttyUSB0;</div><div class="line">    baudrate 115200;</div><div class="line">    flow_control yes;</div><div class="line">    preload 1.1;</div><div class="line">}</div></div><!-- fragment --><p>There is no limit to the number of serial port interfaces that can be defined.</p>
<h2>device statement</h2>
<p>A statement that sets the serial device to listen on. The format is: </p><div class="fragment"><div class="line">device &lt;device string&gt;;</div></div><!-- fragment --><p> where the <code>&lt;device string&gt;</code> is the path to the serial device.</p>
<p>An example is: </p><div class="fragment"><div class="line">device /dev/ttyUSB0;</div></div><!-- fragment --><p>This is the only required statement in a <code>serial</code> block.</p>
<h2>baudrate statement (optional)</h2>
<p>A statement that sets the bitrate (in bits per second) of the serial port. The format is: </p><div class="fragment"><div class="line">baudrate &lt;bitrate&gt;;</div></div><!-- fragment --><p>An example is: </p><div class="fragment"><div class="line">baudrate 115200;</div></div><!-- fragment --><p> which sets the baudrate to 112.5 kbps.</p>
<p><a class="el" href="classIf.html">If</a> not provided the default is to use a baudrate of 9600 (9.4 kbps)</p>
<h2>flow_control statement (optional)</h2>
<p>A statement that enables/disables hardware flow control on the serial port. The format is: </p><div class="fragment"><div class="line">flow_control &lt;yes/no&gt;;</div></div><!-- fragment --><p>To turn on hardware flow control: </p><div class="fragment"><div class="line">flow_control yes;</div></div><!-- fragment --><p>To turn off hardware flow control: </p><div class="fragment"><div class="line">flow_control no;</div></div><!-- fragment --><p><a class="el" href="classIf.html">If</a> not provided the default is to disable hardware flow control.</p>
<h2>preload statement (optional)</h2>
<p>A statement that can preload a MAVLink address on the serial port. Typically mavtables learns about a component when that component sends a packet to the router. In some cases a component may not send a packet until it receives one, in this case the component's address can be preloaded.</p>
<p>One particular case is when two mavtables are in use. Neither instance knows about the other because mavtables will not send any packets over a serial port if nothing has been sent to it over said serial port. By preloading addresses on both instances for the serial port connection they share, the packets from other components will be sent to the other mavtables instance and thus the instances can discover each other's components.</p>
<p>The format is: </p><div class="fragment"><div class="line">preload &lt;MAVLink address&gt;;</div></div><!-- fragment --><p>An example is: </p><div class="fragment"><div class="line">preload 1.1;</div></div><!-- fragment --><p> This indicates that system 1 and component 1 can be reached on this serial port, even before that component sends a packet to the router.</p>
<p>Any number of <code>preload</code> statements are allowed. Every address listed will be added to the serial port.</p>
<h1>chain block</h1>
<p>A <code>chain</code> block defines a filter chain consisting of one or more rules. <a class="el" href="classFilter.html">Filter</a> chains are used to define firewall rules and collect them into groups. The format is: </p><div class="fragment"><div class="line">chain &lt;chain name&gt; {</div><div class="line">    &lt;rule 1&gt;;</div><div class="line">    &lt;rule 2&gt;;</div><div class="line">    &lt;rule ...&gt;;</div><div class="line">    &lt;rule n&gt;;</div><div class="line">}</div></div><!-- fragment --><p>An example is: </p><div class="fragment"><div class="line">chain default</div><div class="line">{</div><div class="line">    reject if ENCAPSULATED_DATA;</div><div class="line">    accept;</div><div class="line">}</div></div><!-- fragment --><p> which rejects the <code>ENCAPSULATED_DATA</code> packet, but accepts all others.</p>
<p>The '<code>default</code>' chain is a reserved name and it must exist. The '<code>default</code>' chain is the one used to filter packets before re-transmitting them. All other chains are called from the default chain or another chain via the '<code>call</code>' or '<code>goto</code>' rules.</p>
<p>There is no limit to the number of filter chains, or to the number of rules in a filter chain.</p>
<h2>Rules</h2>
<p>A rule has the form </p><div class="fragment"><div class="line">&lt;action&gt; &lt;optional priority&gt; &lt;optional condition&gt;;</div></div><!-- fragment --><p> an example is </p><div class="fragment"><div class="line">accept with priority 3 if ENCAPSULATED_DATA from 192.168 to 172.0/8;</div></div><!-- fragment --><p>When evaluating the filter, the first rule a packet matches will decide the fate of the packet. <a class="el" href="classIf.html">If</a> a condition is not provided the rule will match all packets, otherwise the condition decides whether the rule matches or not.</p>
<h3><a class="el" href="classAction.html">Action</a></h3>
<p>There are 4 types of actions a rule can have.</p>
<ul>
<li><code>accept</code> - accept the packet</li>
<li><code>reject</code> - reject the packet</li>
<li><code>call &lt;chain name&gt;</code> - delegate accept/reject decision to another chain, <code>&lt;chain name&gt;</code>. Returns to parent chain if no match in the target chain.</li>
<li><code>goto &lt;chain name&gt;</code> - delegate accept/reject decision to another chain, <code>&lt;chain name&gt;</code>. <a class="el" href="classIf.html">If</a> the target chain never matches the packet then the default action, set in <code>default_action</code> is used.</li>
</ul>
<h3>Priority</h3>
<p>The priority form is: </p><div class="fragment"><div class="line">with priority &lt;priority level&gt;</div></div><!-- fragment --><p> where <code>&lt;priority level&gt;</code> is a positive or negative integer. An example is: </p><div class="fragment"><div class="line">with priority -4</div></div><!-- fragment --><p>A greater integer indicates a higher priority. Packets have a priority of 0 by default. <a class="el" href="classIf.html">If</a> communications slow down and mavtables starts to build a queue of packets to send it will send out the higher priority packets first.</p>
<h3>Condition</h3>
<p>A condition determines whether or not a packet and the address it is being sent to matches a rule. Conditions have the form: </p><div class="fragment"><div class="line">if &lt;packet type&gt; from &lt;source address&gt; to &lt;dest address&gt;;</div></div><!-- fragment --><p> where <code>&lt;packet type&gt;</code>, <code>from &lt;source address&gt;</code>, and <code>to &lt;dest address&gt;</code> are all optional, but one is required, otherwise the rule should not have a condition at all.</p>
<h4>&lt;packet type&gt;</h4>
<p>The name of the packet type to match (upper case). <a class="el" href="classIf.html">If</a> left out all packet types will match.</p>
<h4>&lt;source address&gt;</h4>
<p>A MAVLink subnet to test for containment of the source MAVLink address of the packet.</p>
<h4>&lt;dest address&gt;</h4>
<p>A MAVLink subnet to test for containment of the destination MAVLink address of the packet. The destination address is not regarded as the destination contained in the packet (as that may not exist) but is the MAVLink address of where mavtables is attempting to send the packet. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
