<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mavtables: Connection Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mavtables
   &#160;<span id="projectnumber">0.2.1</span>
   </div>
   <div id="projectbrief">MAVLink router and firewall.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classConnection-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Connection Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="Connection_8hpp_source.html">Connection.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for Connection:</div>
<div class="dyncontent">
<div class="center"><img src="classConnection__coll__graph.png" border="0" usemap="#Connection_coll__map" alt="Collaboration graph"/></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae8c02a1f01c72e36829c2f8c66b2b224"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classConnection.html#ae8c02a1f01c72e36829c2f8c66b2b224">Connection</a> (std::string name, std::shared_ptr&lt; <a class="el" href="classFilter.html">Filter</a> &gt; filter, bool mirror=false, std::unique_ptr&lt; <a class="el" href="classAddressPool.html">AddressPool</a>&lt;&gt;&gt; pool=std::make_unique&lt; <a class="el" href="classAddressPool.html">AddressPool</a>&lt;&gt;&gt;(), std::unique_ptr&lt; <a class="el" href="classPacketQueue.html">PacketQueue</a> &gt; queue=std::make_unique&lt; <a class="el" href="classPacketQueue.html">PacketQueue</a> &gt;())</td></tr>
<tr class="separator:ae8c02a1f01c72e36829c2f8c66b2b224"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d4583d074a044a6c1ed5af57354ce7"><td class="memItemLeft" align="right" valign="top">TEST_VIRTUAL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classConnection.html#a55d4583d074a044a6c1ed5af57354ce7">~Connection</a> ()=default</td></tr>
<tr class="separator:a55d4583d074a044a6c1ed5af57354ce7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e07bc029c10c5a6779211fd23a79443"><td class="memItemLeft" align="right" valign="top">TEST_VIRTUAL void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classConnection.html#a1e07bc029c10c5a6779211fd23a79443">add_address</a> (<a class="el" href="classMAVAddress.html">MAVAddress</a> address)</td></tr>
<tr class="separator:a1e07bc029c10c5a6779211fd23a79443"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e51a3ed7df32ae093f40af2814163a4"><td class="memItemLeft" align="right" valign="top">TEST_VIRTUAL std::shared_ptr&lt; const <a class="el" href="classPacket.html">Packet</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classConnection.html#a6e51a3ed7df32ae093f40af2814163a4">next_packet</a> (const std::chrono::nanoseconds &amp;timeout=std::chrono::nanoseconds(0))</td></tr>
<tr class="separator:a6e51a3ed7df32ae093f40af2814163a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a6940f396887d3baf24d8ea6daabada"><td class="memItemLeft" align="right" valign="top">TEST_VIRTUAL void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classConnection.html#a7a6940f396887d3baf24d8ea6daabada">send</a> (std::shared_ptr&lt; const <a class="el" href="classPacket.html">Packet</a> &gt; packet)</td></tr>
<tr class="separator:a7a6940f396887d3baf24d8ea6daabada"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:abcafed6524d9e106791d700379ecd9c2"><td class="memItemLeft" align="right" valign="top">std::ostream &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classConnection.html#abcafed6524d9e106791d700379ecd9c2">operator&lt;&lt;</a> (std::ostream &amp;os, const <a class="el" href="classConnection.html">Connection</a> &amp;connection)</td></tr>
<tr class="separator:abcafed6524d9e106791d700379ecd9c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Represents a connection that packets can be sent over.</p>
<p>The connection class does not actually send anything. It filters and sorts packets in a queue for sending by an <a class="el" href="classInterface.html">Interface</a>. It also maintains a list of MAVLink addresses reachable on this connection. </p>

<p class="definition">Definition at line <a class="el" href="Connection_8hpp_source.html#l00039">39</a> of file <a class="el" href="Connection_8hpp_source.html">Connection.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ae8c02a1f01c72e36829c2f8c66b2b224"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8c02a1f01c72e36829c2f8c66b2b224">&#9670;&nbsp;</a></span>Connection()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Connection::Connection </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="classFilter.html">Filter</a> &gt;&#160;</td>
          <td class="paramname"><em>filter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>mirror</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="classAddressPool.html">AddressPool</a>&lt;&gt;&gt;&#160;</td>
          <td class="paramname"><em>pool</em> = <code>std::make_unique&lt;<a class="el" href="classAddressPool.html">AddressPool</a>&lt;&gt;&gt;()</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::unique_ptr&lt; <a class="el" href="classPacketQueue.html">PacketQueue</a> &gt;&#160;</td>
          <td class="paramname"><em>queue</em> = <code>std::make_unique&lt;<a class="el" href="classPacketQueue.html">PacketQueue</a>&gt;()</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Construct a connection.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The name of the connection, should be the device string for a serial connection or the IP address and port number for a UDP connection. </td></tr>
    <tr><td class="paramname">filter</td><td>The packet filter to use for determining whether and with what priority to add a packet to the queue for transmission. </td></tr>
    <tr><td class="paramname">mirror</td><td>Set to true if this is to be a mirror connection. A mirror connection is one that will receive all packets, regardless of destination address. The default is false. </td></tr>
    <tr><td class="paramname">pool</td><td>The <a class="el" href="classAddressPool.html">AddressPool</a> to use for keeping track of the addresses reachable by the connection. A default address pool will be used if none is given. </td></tr>
    <tr><td class="paramname">queue</td><td>The <a class="el" href="classPacketQueue.html">PacketQueue</a> to use to hold packets awaiting transmission. A default packet queue will be used if none is given. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::invalid_argument</td><td>if the given any of the <code>filter</code>, <code>pool</code>, or <code>queue</code> pointers are null. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section remark"><dt>Remarks</dt><dd><a class="el" href="classIf.html">If</a> the given <a class="el" href="classAddressPool.html">AddressPool</a> and <a class="el" href="classPacketQueue.html">PacketQueue</a> are threadsafe then the connection will also be threadsafe. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Connection_8cpp_source.html#l00244">244</a> of file <a class="el" href="Connection_8cpp_source.html">Connection.cpp</a>.</p>

</div>
</div>
<a id="a55d4583d074a044a6c1ed5af57354ce7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55d4583d074a044a6c1ed5af57354ce7">&#9670;&nbsp;</a></span>~Connection()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">TEST_VIRTUAL Connection::~Connection </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">default</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1e07bc029c10c5a6779211fd23a79443"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e07bc029c10c5a6779211fd23a79443">&#9670;&nbsp;</a></span>add_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Connection::add_address </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classMAVAddress.html">MAVAddress</a>&#160;</td>
          <td class="paramname"><em>address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a MAVLink address to the connection.</p>
<p>This adds an address to the list of systems/components that can be reached on this connection.</p>
<dl class="section note"><dt>Note</dt><dd>Addresses will be removed after the timeout set in the <a class="el" href="classAddressPool.html">AddressPool</a> given in the constructor. Re-adding the address (even before this time runs out) will reset the timeout.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>The MAVLink address to add, or update the timeout for. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="Connection_8cpp_source.html#l00281">281</a> of file <a class="el" href="Connection_8cpp_source.html">Connection.cpp</a>.</p>

<p class="reference">References <a class="el" href="Logger_8cpp_source.html#l00096">Logger::level()</a>, <a class="el" href="Logger_8cpp_source.html#l00037">Logger::log()</a>, and <a class="el" href="utility_8hpp_source.html#l00128">str()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classConnection_a1e07bc029c10c5a6779211fd23a79443_cgraph.png" border="0" usemap="#classConnection_a1e07bc029c10c5a6779211fd23a79443_cgraph" alt=""/></div>
<map name="classConnection_a1e07bc029c10c5a6779211fd23a79443_cgraph" id="classConnection_a1e07bc029c10c5a6779211fd23a79443_cgraph">
<area shape="rect" id="node2" href="classLogger.html#aa5aa64f09326d5a76fc567883d8c056b" title="Logger::level" alt="" coords="224,5,320,32"/>
<area shape="rect" id="node3" href="classLogger.html#a0697a189b6921c9c22ef7f0702ae14f7" title="Logger::log" alt="" coords="229,56,315,83"/>
<area shape="rect" id="node4" href="group__utility.html#ga62d901562ed7a88fb9536040cbc6b2f7" title="str" alt="" coords="253,107,291,133"/>
</map>
</div>

</div>
</div>
<a id="a6e51a3ed7df32ae093f40af2814163a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e51a3ed7df32ae093f40af2814163a4">&#9670;&nbsp;</a></span>next_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt; const <a class="el" href="classPacket.html">Packet</a> &gt; Connection::next_packet </td>
          <td>(</td>
          <td class="paramtype">const std::chrono::nanoseconds &amp;&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>std::chrono::nanoseconds(0)</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get next packet to send.</p>
<p>Blocks until a packet is ready to be sent or the <code>timeout</code> expires. Returns nullptr in the later case.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeout</td><td>How long to block waiting for a packet. Set to 0s for non blocking. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The next packet to send. Or nullptr if the call times out waiting on a packet. </dd></dl>

<p class="definition">Definition at line <a class="el" href="Connection_8cpp_source.html#l00303">303</a> of file <a class="el" href="Connection_8cpp_source.html">Connection.cpp</a>.</p>

</div>
</div>
<a id="a7a6940f396887d3baf24d8ea6daabada"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a6940f396887d3baf24d8ea6daabada">&#9670;&nbsp;</a></span>send()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Connection::send </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; const <a class="el" href="classPacket.html">Packet</a> &gt;&#160;</td>
          <td class="paramname"><em>packet</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send a packet out on the connection.</p>
<p>Packets are ran through the contained <a class="el" href="classFilter.html">Filter</a> before being placed into the <a class="el" href="classPacketQueue.html">PacketQueue</a> given in the constructor. Packets are read from the queue (for sending) by using the <a class="el" href="classConnection.html#a6e51a3ed7df32ae093f40af2814163a4">next_packet</a> method.</p>
<dl class="section note"><dt>Note</dt><dd>If the packet has a destination address that is not 0.0 (the broadcast address) it will only be sent if that system is reachable on this connection. It will still be sent even if the particular component cannot be found.</dd>
<dd>
If this is a mirror connection then the destination address of the packet is ignored.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">packet</td><td>The packet to send. </td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">std::invalid_argument</td><td>if the <code>packet</code> pointer is null. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="Connection_8cpp_source.html#l00327">327</a> of file <a class="el" href="Connection_8cpp_source.html">Connection.cpp</a>.</p>

<p class="reference">References <a class="el" href="MAVAddress_8cpp_source.html#l00171">MAVAddress::component()</a>, and <a class="el" href="MAVAddress_8cpp_source.html#l00161">MAVAddress::system()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classConnection_a7a6940f396887d3baf24d8ea6daabada_cgraph.png" border="0" usemap="#classConnection_a7a6940f396887d3baf24d8ea6daabada_cgraph" alt=""/></div>
<map name="classConnection_a7a6940f396887d3baf24d8ea6daabada_cgraph" id="classConnection_a7a6940f396887d3baf24d8ea6daabada_cgraph">
<area shape="rect" id="node2" href="classMAVAddress.html#a6ac07e9e4ca9d1b708a983a2dc79ce96" title="MAVAddress::component" alt="" coords="177,5,347,32"/>
<area shape="rect" id="node3" href="classMAVAddress.html#a68cef7870a5a19bb596113491200cea5" title="MAVAddress::system" alt="" coords="188,56,336,83"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Friends And Related Function Documentation</h2>
<a id="abcafed6524d9e106791d700379ecd9c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcafed6524d9e106791d700379ecd9c2">&#9670;&nbsp;</a></span>operator&lt;&lt;</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::ostream&amp; operator&lt;&lt; </td>
          <td>(</td>
          <td class="paramtype">std::ostream &amp;&#160;</td>
          <td class="paramname"><em>os</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classConnection.html">Connection</a> &amp;&#160;</td>
          <td class="paramname"><em>connection</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">friend</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Print the connection name to the given output stream.</p>
<p>Some examples are:</p><ul>
<li><code>/dev/ttyUSB0</code></li>
<li><code>127.0.0.1:8000</code></li>
<li><code>127.0.0.1:14550</code> </li>
</ul>

<p class="definition">Definition at line <a class="el" href="Connection_8cpp_source.html#l00368">368</a> of file <a class="el" href="Connection_8cpp_source.html">Connection.cpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Connection_8hpp_source.html">Connection.hpp</a></li>
<li><a class="el" href="Connection_8cpp_source.html">Connection.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
