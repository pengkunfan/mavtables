<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mavtables: MAVTables User Manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mavtables
   &#160;<span id="projectnumber">0.2.1</span>
   </div>
   <div id="projectbrief">MAVLink router and firewall.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MAVTables User Manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="https://github.com/shamuproject/mavtables">Project</a></li>
<li><a href="#installing">Installing</a><ul>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#cmake-installation">CMake Installation</a></li>
<li><a href="#manual-installation">Manual Installation</a></li>
</ul>
</li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#running">Running</a></li>
<li><a href="#log-level">Log Level</a><ul>
<li><a href="#--loglevel-0">&ndash;loglevel 0</a></li>
<li><a href="#--loglevel-1">&ndash;loglevel 1</a></li>
<li><a href="#--loglevel-2">&ndash;loglevel 2</a></li>
<li><a href="#--loglevel-3">&ndash;loglevel 3</a></li>
</ul>
</li>
<li><a href="#abstract-syntax-tree">Abstract Syntax Tree</a></li>
</ul>
</li>
<li><a class="el" href="configuration_8md.html">Configuration</a></li>
</ul>
<h1>Installing</h1>
<h2>Requirements</h2>
<p>In order to compile you will need the following packages:</p>
<ul>
<li>GCC 7+ or Clang 5+ (needed for C++17 support)</li>
<li><a href="https://cmake.org/">CMake v3.3+</a></li>
<li><a href="https://www.boost.org/">Boost v1.54+</a></li>
</ul>
<p>on either</p>
<ul>
<li>Linux</li>
<li>Mac OS X</li>
<li>BSD</li>
</ul>
<p>mavtables is tested on both Linux and Mac OS X and should work on any unix compatible system.</p>
<h2>CMake Installation</h2>
<p>To install via CMake simple run: </p><div class="fragment"><div class="line">$ make</div><div class="line">$ make install</div></div><!-- fragment --><p>The installation prefix is <code>/usr/local</code> by default but can be changed with </p><div class="fragment"><div class="line">$ make PREFIX=/desired/install/path</div><div class="line"># make DESDIR=/desired/install/path install</div></div><!-- fragment --><p> <code>PREFIX</code> changes where mavtables expects to be installed while <code>DESTDIR</code> changes where it will actually be installed.</p>
<p>To change the MAVLink dialect use the <code>DIALECT</code> environment variable. For example, to use the <code>common</code> dialect: </p><div class="fragment"><div class="line">$ make DIALECT=common</div><div class="line"># make install</div></div><!-- fragment --><p>To change the MAVLink implementation completely use the <code>MDIR</code> environment variable to set the path to the MAVLink library instead of downloading the upstream implementation. For example, if a custom implementation is at <code>/tmp/mavlink/v2</code> then: </p><div class="fragment"><div class="line">$ make MDIR=/tmp/mavlink/v2</div><div class="line"># make install</div></div><!-- fragment --><p> Both the <code>MDIR</code> and <code>DIALECT</code> variables can be used together.</p>
<h2>Manual Installation</h2>
<p>To manually install mavtables first make a release build: </p><div class="fragment"><div class="line">$ make</div></div><!-- fragment --><p> Remembering to use the <code>PREFIX</code> option if the final installation destination is not <code>/usr/local</code>.</p>
<p>Copy binary, configuration, and systemd unit files to their proper locations </p><div class="fragment"><div class="line"># cp build/mavtables /usr/local/bin/</div><div class="line"># cp examples/mavtables.conf /usr/local/etc/</div><div class="line"># cp build/mavtables.service /usr/local/lib/systemd/system/</div></div><!-- fragment --><h1>Usage</h1>
<h2>Running</h2>
<p>To run mavtables and begin routing packets </p><div class="fragment"><div class="line">$ mavtables</div></div><!-- fragment --><p> This will use the first configuration file it finds in the configuration file priority order:</p>
<ol type="1">
<li>The target of the <code>MAVTABLES_CONFIG_PATH</code> environment variable.</li>
<li><code>.mavtablesrc</code> in the current directory.</li>
<li><code>.mavtablesrc</code> at <code>$HOME/.mavtablesrc</code>.</li>
<li>The main configuration file at <code>/etc/mavtables.conf</code>.</li>
</ol>
<p>To specify the configuration file use </p><div class="fragment"><div class="line">$ mavtables --config path/to/config/file</div></div><!-- fragment --><p><a class="el" href="classIf.html">If</a> the configuration file contains an error, mavtables will exit immediately and print an error message to stderr.</p>
<p>The installer will install a system wide configuration file at <code>PREFIX/etc/mavtables.conf</code> and a systemd unit file at <code>PREFIX/lib/systemd/system/mavtables.service</code>. Therefore, on Linux (with systemd) mavtables can be run as a daemon with </p><div class="fragment"><div class="line"># systemctl start mavtables</div></div><!-- fragment --><p> or enabled for startup on each boot with </p><div class="fragment"><div class="line"># systemctl enable mavtables</div></div><!-- fragment --><p>systemd will keep mavtables running (even if it crashes) and will use the <code>PREFIX/etc/mavtables.conf</code> configuration file. It will also use <code>loglevel</code> 1, discussed in the <a href="#log-level">Log Level</a> section below.</p>
<h2>Log Level</h2>
<p>The <code>--loglevel</code> flag can be use to set the logging level. This is the verbosity to print to stdout when mavtables is running. Each loglevel, 0 through 3, is documented below.</p>
<h3>&ndash;loglevel 0</h3>
<p>Do not log anything to stdcout.</p>
<h3>&ndash;loglevel 1</h3>
<p>Log each new component. Therefore, every time a new system/component address is connected to the router it will be printed to stdcout. An example log output is: </p><div class="fragment"><div class="line">new component 127.1 on 127.0.0.1</div><div class="line">new component 192.168 on 127.0.0.1</div><div class="line">new component 172.128 on ./ttyS0</div><div class="line">new component 10.10 on 127.0.0.1</div></div><!-- fragment --><h3>&ndash;loglevel 2</h3>
<p>In addition to everything in <code>--loglevel 1</code> this will log received packets to stdcout. An example log output is: </p><div class="fragment"><div class="line">new component 127.1 on 127.0.0.1</div><div class="line">received HEARTBEAT (#0) from 127.1 (v2.0) source 127.0.0.1</div><div class="line">new component 192.168 on 127.0.0.1</div><div class="line">received HEARTBEAT (#0) from 192.168 (v2.0) source 127.0.0.1</div><div class="line">new component 172.128 on ./ttyS0</div><div class="line">received HEARTBEAT (#0) from 172.128 (v2.0) source ./ttyS0</div><div class="line">new component 10.10 on 127.0.0.1</div><div class="line">received HEARTBEAT (#0) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received POWER_STATUS (#125) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received SYS_STATUS (#1) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received GPS_RAW_INT (#24) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received LOCAL_POSITION_NED_COV (#64) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received MISSION_REQUEST_PARTIAL_LIST (#37) from 10.10 to 172.168 (v2.0) source 127.0.0.1</div><div class="line">received LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET (#89) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received MANUAL_CONTROL (#69) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received GPS_INPUT (#232) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received VFR_HUD (#74) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received LANDING_TARGET (#149) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received SCALED_IMU (#26) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">received PARAM_REQUEST_READ (#20) from 10.10 to 192.168 (v2.0) source 127.0.0.1</div></div><!-- fragment --><h3>&ndash;loglevel 3</h3>
<p>In addition to everything in <code>--loglevel 1</code> and <code>--loglevel 2</code> this will log routed packets, indicating whether they are <code>accepted</code> or <code>rejected</code>, to stdcout. An example log output is: </p><div class="fragment"><div class="line">new component 127.1 on 127.0.0.1</div><div class="line">received HEARTBEAT (#0) from 127.1 (v2.0) source 127.0.0.1</div><div class="line">rejected HEARTBEAT (#0) from 127.1 (v2.0) source 127.0.0.1 dest ./ttyS0</div><div class="line">new component 192.168 on 127.0.0.1</div><div class="line">received HEARTBEAT (#0) from 192.168 (v2.0) source 127.0.0.1</div><div class="line">rejected HEARTBEAT (#0) from 192.168 (v2.0) source 127.0.0.1 dest ./ttyS0</div><div class="line">rejected HEARTBEAT (#0) from 192.168 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">new component 172.128 on ./ttyS0</div><div class="line">received HEARTBEAT (#0) from 172.128 (v2.0) source ./ttyS0</div><div class="line">rejected HEARTBEAT (#0) from 172.128 (v2.0) source ./ttyS0 dest 127.0.0.1</div><div class="line">rejected HEARTBEAT (#0) from 172.128 (v2.0) source ./ttyS0 dest 127.0.0.1</div><div class="line">new component 10.10 on 127.0.0.1</div><div class="line">received HEARTBEAT (#0) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">rejected HEARTBEAT (#0) from 10.10 (v2.0) source 127.0.0.1 dest ./ttyS0</div><div class="line">rejected HEARTBEAT (#0) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">rejected HEARTBEAT (#0) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">received POWER_STATUS (#125) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">rejected POWER_STATUS (#125) from 10.10 (v2.0) source 127.0.0.1 dest ./ttyS0</div><div class="line">accepted POWER_STATUS (#125) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">rejected POWER_STATUS (#125) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">received SYS_STATUS (#1) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">accepted SYS_STATUS (#1) from 10.10 (v2.0) source 127.0.0.1 dest ./ttyS0</div><div class="line">accepted SYS_STATUS (#1) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">accepted SYS_STATUS (#1) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">received GPS_RAW_INT (#24) from 10.10 (v2.0) source 127.0.0.1</div><div class="line">rejected GPS_RAW_INT (#24) from 10.10 (v2.0) source 127.0.0.1 dest ./ttyS0</div><div class="line">accepted GPS_RAW_INT (#24) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div><div class="line">accepted GPS_RAW_INT (#24) from 10.10 (v2.0) source 127.0.0.1 dest 127.0.0.1</div></div><!-- fragment --><h2>Abstract Syntax Tree</h2>
<p>mavtables can print the abstract syntax tree of the configuration file instead of routing packets. When run in this mode it will return immediately This is accomplished with: </p><div class="fragment"><div class="line">$ mavtables --ast</div></div><!-- fragment --><p> or </p><div class="fragment"><div class="line">$ mavtables  --ast --config path/to/config/file</div></div><!-- fragment --><p> which will print something similar to </p><div class="fragment"><div class="line">===== /etc/mavtables.conf =====</div><div class="line">:005:  default_action</div><div class="line">:005:  |  reject</div><div class="line">:008:  udp</div><div class="line">:009:  |  port 14500</div><div class="line">:010:  |  address 127.0.0.1</div><div class="line">:022:  chain default</div><div class="line">:023:  |  accept</div></div><!-- fragment --><p>This feature can be used to debug configuration files.</p>
<p>For and explanation of configuration files see <a class="el" href="configuration_8md.html">Configuration</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
